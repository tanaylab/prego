<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-US"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Perform a PWM regression — regress_multiple_motifs • prego</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Perform a PWM regression — regress_multiple_motifs"><meta name="description" content="Perform a PWM regression"><meta property="og:description" content="Perform a PWM regression"></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">prego</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.9</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Perform a PWM regression</h1>

      <div class="d-none name"><code>regress_pwm.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>Perform a PWM regression</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">regress_multiple_motifs</span><span class="op">(</span></span>
<span>  <span class="va">sequences</span>,</span>
<span>  <span class="va">response</span>,</span>
<span>  motif <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  motif_length <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  score_metric <span class="op">=</span> <span class="st">"r2"</span>,</span>
<span>  bidirect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spat_bin_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spat_num_bins <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spat_model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  improve_epsilon <span class="op">=</span> <span class="fl">0.0001</span>,</span>
<span>  min_nuc_prob <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  unif_prior <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  include_response <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">60427</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  kmer_length <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  multi_kmers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  final_metric <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_cands <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  min_gap <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max_gap <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min_kmer_cor <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>  motif_num <span class="op">=</span> <span class="fl">2</span>,</span>
<span>  smooth_k <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  consensus_single_thresh <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  consensus_double_thresh <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  internal_num_folds <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  match_with_db <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  motif_dataset <span class="op">=</span> <span class="fu"><a href="all_motif_datasets.html">all_motif_datasets</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"prego.parallel"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"less"</span>,</span>
<span>  sample_for_kmers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sample_frac <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_idxs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  log_energy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  energy_func_generator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  energy_func <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optimize_pwm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  optimize_spat <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span>
<span></span>
<span><span class="fu">regress_pwm</span><span class="op">(</span></span>
<span>  <span class="va">sequences</span>,</span>
<span>  <span class="va">response</span>,</span>
<span>  motif <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  motif_length <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  init_from_dataset <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  score_metric <span class="op">=</span> <span class="st">"r2"</span>,</span>
<span>  bidirect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spat_bin_size <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spat_num_bins <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spat_model <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  improve_epsilon <span class="op">=</span> <span class="fl">0.0001</span>,</span>
<span>  min_nuc_prob <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  unif_prior <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  include_response <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">60427</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  kmer_length <span class="op">=</span> <span class="fl">8</span>,</span>
<span>  multi_kmers <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  final_metric <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  max_cands <span class="op">=</span> <span class="fl">10</span>,</span>
<span>  min_gap <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max_gap <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min_kmer_cor <span class="op">=</span> <span class="fl">0.08</span>,</span>
<span>  motif_num <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  smooth_k <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  consensus_single_thresh <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  consensus_double_thresh <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  internal_num_folds <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  match_with_db <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  screen_db <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  motif_dataset <span class="op">=</span> <span class="fu"><a href="all_motif_datasets.html">all_motif_datasets</a></span><span class="op">(</span><span class="op">)</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"prego.parallel"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  alternative <span class="op">=</span> <span class="st">"less"</span>,</span>
<span>  sample_for_kmers <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  sample_frac <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_idxs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  sample_ratio <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  val_frac <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  log_energy <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  energy_func <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  xmin <span class="op">=</span> <span class="op">-</span><span class="fl">100</span>,</span>
<span>  xmax <span class="op">=</span> <span class="fl">100</span>,</span>
<span>  npts <span class="op">=</span> <span class="fl">10000</span>,</span>
<span>  energy_func_generator <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  optimize_pwm <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  optimize_spat <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  kmer_sequence_length <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  symmetrize_spat <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-sequences">sequences<a class="anchor" aria-label="anchor" href="#arg-sequences"></a></dt>
<dd><p>A vector of DNA sequences ('A', 'T', 'C' or 'G'. Will go through <code>toupper</code>). Please make sure that the sequences are long enough to cover <code>spat_num_bins</code> * <code>spat_bin_size</code> bp, and that they are centered around the motif/signal.</p></dd>


<dt id="arg-response">response<a class="anchor" aria-label="anchor" href="#arg-response"></a></dt>
<dd><p>A matrix of response variables - number of rows should equal the number of sequences</p></dd>


<dt id="arg-motif">motif<a class="anchor" aria-label="anchor" href="#arg-motif"></a></dt>
<dd><p>Initial motif to start the regression from. Can be either a string with a kmer where the character "*" indicates a
wildcard or a data frame with a pre-computed PSSM (see the slot <code>pssm</code> in the return value of this function).
If NULL - a K-mer screen would be performed in order to find the best kmer for initialization. If <code>init_from_dataset</code> is TRUE, the regression would be initialized from the PSSM of the best motif in the dataset.</p></dd>


<dt id="arg-motif-length">motif_length<a class="anchor" aria-label="anchor" href="#arg-motif-length"></a></dt>
<dd><p>Length of the seed motif. If the motif is shorter than this, it will be extended by wildcards (stars). Note that If the motif is longer than this, it will <em>not</em> be truncated.</p></dd>


<dt id="arg-score-metric">score_metric<a class="anchor" aria-label="anchor" href="#arg-score-metric"></a></dt>
<dd><p>metric to use for optimizing the PWM. One of "r2" or "ks". When using "ks" the response variable should be a single vector of 0 and 1.</p></dd>


<dt id="arg-bidirect">bidirect<a class="anchor" aria-label="anchor" href="#arg-bidirect"></a></dt>
<dd><p>is the motif bi-directional. If TRUE, the reverse-complement of the motif will be used as well.</p></dd>


<dt id="arg-spat-bin-size">spat_bin_size<a class="anchor" aria-label="anchor" href="#arg-spat-bin-size"></a></dt>
<dd><p>size of the spatial bin (in bp).</p></dd>


<dt id="arg-spat-num-bins">spat_num_bins<a class="anchor" aria-label="anchor" href="#arg-spat-num-bins"></a></dt>
<dd><p>number of spatial bins. Please make sure that the sequences are long enough to cover this number of bins. bp outside of spat_bin_size * spat_num_bins would be ignored. If <code>bidirect</code> is TRUE, the number of bins should be odd as 'prego' symmetrizes the motif around the center bin.</p></dd>


<dt id="arg-spat-model">spat_model<a class="anchor" aria-label="anchor" href="#arg-spat-model"></a></dt>
<dd><p>a previously computed spatial model (see <code>spat</code>) in the return value of this function.</p></dd>


<dt id="arg-improve-epsilon">improve_epsilon<a class="anchor" aria-label="anchor" href="#arg-improve-epsilon"></a></dt>
<dd><p>minimum improve in the objective function to continue the optimization</p></dd>


<dt id="arg-min-nuc-prob">min_nuc_prob<a class="anchor" aria-label="anchor" href="#arg-min-nuc-prob"></a></dt>
<dd><p>minimum nucleotide probability in every iteration</p></dd>


<dt id="arg-unif-prior">unif_prior<a class="anchor" aria-label="anchor" href="#arg-unif-prior"></a></dt>
<dd><p>uniform prior for nucleotide probabilities</p></dd>


<dt id="arg-include-response">include_response<a class="anchor" aria-label="anchor" href="#arg-include-response"></a></dt>
<dd><p>include the response in the resulting list (default: TRUE)</p></dd>


<dt id="arg-seed">seed<a class="anchor" aria-label="anchor" href="#arg-seed"></a></dt>
<dd><p>random seed</p></dd>


<dt id="arg-verbose">verbose<a class="anchor" aria-label="anchor" href="#arg-verbose"></a></dt>
<dd><p>show verbose messages.</p></dd>


<dt id="arg-kmer-length">kmer_length<a class="anchor" aria-label="anchor" href="#arg-kmer-length"></a></dt>
<dd><p>a vector of kmer lengths to screen in order to find the best seed motif.</p></dd>


<dt id="arg-multi-kmers">multi_kmers<a class="anchor" aria-label="anchor" href="#arg-multi-kmers"></a></dt>
<dd><p>if TRUE, different candidates of kmers would be regressed in order to find the best seed according to <code>final_metric</code>.</p></dd>


<dt id="arg-final-metric">final_metric<a class="anchor" aria-label="anchor" href="#arg-final-metric"></a></dt>
<dd><p>metric to use in order to choose the best motif. One of 'ks' or 'r2'. Note that unlike <code>score_metric</code> which is used in the regression itself, this metric is used only for choosing the best motif out of all the runs on the sampled dataset. If NULL - 'ks' would be used for binary response and 'r2' for continuous response.</p></dd>


<dt id="arg-max-cands">max_cands<a class="anchor" aria-label="anchor" href="#arg-max-cands"></a></dt>
<dd><p>maximum number of kmer candidates to try.</p></dd>


<dt id="arg-min-gap-max-gap">min_gap, max_gap<a class="anchor" aria-label="anchor" href="#arg-min-gap-max-gap"></a></dt>
<dd><p>the length of a gap to be considered in the pattern. Only one gap, of length min_gap:max_gap, is being used, and is located anywhere in the motif. Note that this greatly expand the search space (and increase multiple testing severely).</p></dd>


<dt id="arg-min-kmer-cor">min_kmer_cor<a class="anchor" aria-label="anchor" href="#arg-min-kmer-cor"></a></dt>
<dd><p>minimal correlation between the kmer and the response in order to use it as a seed.</p></dd>


<dt id="arg-motif-num">motif_num<a class="anchor" aria-label="anchor" href="#arg-motif-num"></a></dt>
<dd><p>Number of motifs to infer. When <code>motif_num</code> &gt; 1, the function would run <code>motif_num</code> times, each time on the residuals of a linear model of all the previous runs (see <code>smooth_k</code> parameter). The best motif is then returned, while all the others are stored at 'models' in the return value.</p></dd>


<dt id="arg-smooth-k">smooth_k<a class="anchor" aria-label="anchor" href="#arg-smooth-k"></a></dt>
<dd><p>k for smoothing the predictions of each model in order to compute the residuals when <code>motif_num</code> &gt; 1. The residuals are computed as <code>response</code> - running mean of size 'k' of the current model.</p></dd>


<dt id="arg-consensus-single-thresh-consensus-double-thresh">consensus_single_thresh, consensus_double_thresh<a class="anchor" aria-label="anchor" href="#arg-consensus-single-thresh-consensus-double-thresh"></a></dt>
<dd><p>thresholds for the consensus sequence calculation
(single and double nucleotides)</p></dd>


<dt id="arg-internal-num-folds">internal_num_folds<a class="anchor" aria-label="anchor" href="#arg-internal-num-folds"></a></dt>
<dd><p>number of folds to use in the internal cross-validation.</p></dd>


<dt id="arg-match-with-db">match_with_db<a class="anchor" aria-label="anchor" href="#arg-match-with-db"></a></dt>
<dd><p>match the resulting PWMs with motif databases using <code>pssm_match</code>. Note that the closest match
is returned, even if it is not similar enough in absolute terms.</p></dd>


<dt id="arg-motif-dataset">motif_dataset<a class="anchor" aria-label="anchor" href="#arg-motif-dataset"></a></dt>
<dd><p>a data frame with PSSMs ('A', 'C', 'G' and 'T' columns), with an additional column 'motif' containing the motif name, for example <code>HOMER_motifs</code>, <code>JASPAR_motifs</code> or all_motif_datasets(). By default all_motif_datasets() would be used.</p></dd>


<dt id="arg-parallel">parallel<a class="anchor" aria-label="anchor" href="#arg-parallel"></a></dt>
<dd><p>whether to run optimization in parallel. use <code>set_parallel</code>
to set the number of cores to use.</p></dd>


<dt id="arg-alternative">alternative<a class="anchor" aria-label="anchor" href="#arg-alternative"></a></dt>
<dd><p>alternative hypothesis for the p-value calculation when using <code>ks.test</code>. One of "two.sided", "less" or "greater".</p></dd>


<dt id="arg-sample-for-kmers">sample_for_kmers<a class="anchor" aria-label="anchor" href="#arg-sample-for-kmers"></a></dt>
<dd><p>Use a random sample of the dataset in order to find the best kmer. This is useful when the dataset is very large and the kmer screen would take a long time. Note that the final regression would be performed on the entire dataset. Only relevant when <code>multi_kmers</code> is TRUE.</p></dd>


<dt id="arg-sample-frac">sample_frac<a class="anchor" aria-label="anchor" href="#arg-sample-frac"></a></dt>
<dd><p>fraction of the dataset to use for the kmer screen. Default: 0.1.</p></dd>


<dt id="arg-sample-idxs">sample_idxs<a class="anchor" aria-label="anchor" href="#arg-sample-idxs"></a></dt>
<dd><p>indices of the sequences to use for the kmer screen. If NULL, a random sample would be used.</p></dd>


<dt id="arg-sample-ratio">sample_ratio<a class="anchor" aria-label="anchor" href="#arg-sample-ratio"></a></dt>
<dd><p>ratio between the '1' category and the '0' category in the sampled dataset (for binary response). Relevant only when <code>sample_frac</code> is NULL.</p></dd>


<dt id="arg-log-energy">log_energy<a class="anchor" aria-label="anchor" href="#arg-log-energy"></a></dt>
<dd><p>transform the energy to log scale on each iteration.</p></dd>


<dt id="arg-energy-func-generator">energy_func_generator<a class="anchor" aria-label="anchor" href="#arg-energy-func-generator"></a></dt>
<dd><p>a function to generate the energy function when regressing multiple motifs. Should accept the result of the previous iteration + the original response and return a function similar to <code>energy_func</code>. e.g. <code>
function(prev_reg, resp) {
       df &lt;- data.frame(x = prev_reg$pred, y = resp)
       fn_gam &lt;- as.formula("y ~ s(x, k=3, bs='cr')")
       model &lt;- mgcv::gam(fn_gam, family = binomial(link = "logit"), data = df, method="REML")
       function(z){
           mgcv::predict.gam(object = model, newdata = data.frame(x = z))
}}</code>.
When this parameter is not NULL, energy_func_generator would create an energy function and then run another step of regression initialized with the previous motif with <code>energy_func</code> as the energy function. This is useful when the energy function is not monotonic, for example - one might want to use a gam model to fit the energy function like in the example above.</p></dd>


<dt id="arg-energy-func">energy_func<a class="anchor" aria-label="anchor" href="#arg-energy-func"></a></dt>
<dd><p>a function to transform the energy at each iteration. Should accept a numeric vector and return a numeric vector. e.g. <code>log</code> or <code>function(x) x^2</code>. Note that the range of the input energies is between 0 and 1 (the probability of the motif in the sequence), so if you inferred the function using the the returned energies (which are in log scale) you should make sure that the function first log transforms using <code>log_energy=TRUE</code>.</p></dd>


<dt id="arg-optimize-pwm">optimize_pwm<a class="anchor" aria-label="anchor" href="#arg-optimize-pwm"></a></dt>
<dd><p>optimize the PWM model (Default: TRUE). If FALSE, the PWM model would be used as the initial model for the spatial model.</p></dd>


<dt id="arg-optimize-spat">optimize_spat<a class="anchor" aria-label="anchor" href="#arg-optimize-spat"></a></dt>
<dd><p>optimize the spatial model (Default: TRUE). If FALSE, the spatial model would be used as the initial model for the PWM model.</p></dd>


<dt id="arg--">...<a class="anchor" aria-label="anchor" href="#arg--"></a></dt>
<dd><p>Arguments passed on to <code><a href="screen_kmers.html">screen_kmers</a></code></p><dl><dt><code>min_cor</code></dt>
<dd><p>Only patterns for which the maximum correlation to one of the response variable is larger than min_cor will be reported</p></dd>

    <dt><code>is_train</code></dt>
<dd><p>a boolean vector that determine which subset of sequences to use when screening</p></dd>

    <dt><code>min_gap,max_gap</code></dt>
<dd><p>the length of a gap to be considered in the pattern. Only one gap, of length min_gap:max_gap, is being used, and is located anywhere in the motif. Note that this greatly expand the search space (and increase multiple testing severely).</p></dd>

    <dt><code>from_range</code></dt>
<dd><p>Sequences will be considered only from position from_range (default 0)</p></dd>

    <dt><code>to_range</code></dt>
<dd><p>Sequences will be considered only up to position to_range (default NULL - using the length of the sequences)</p></dd>

    <dt><code>return_mat</code></dt>
<dd><p>Return a matrix of patterns and their correlation to the response variables instead of a data frame. (default: FALSE)</p></dd>


</dl></dd>


<dt id="arg-init-from-dataset">init_from_dataset<a class="anchor" aria-label="anchor" href="#arg-init-from-dataset"></a></dt>
<dd><p>initialize the regression from the PSSM of the best motif in <code>motif_dataset</code>, using <code>final_metric</code> as the metric. If TRUE, the <code>motif</code> parameter would be ignored. See <code><a href="screen_pwm.html">screen_pwm</a></code> for more details.</p></dd>


<dt id="arg-screen-db">screen_db<a class="anchor" aria-label="anchor" href="#arg-screen-db"></a></dt>
<dd><p>Screen <code>motif_dataset</code> using <code>screen_pwm</code> and use the best motif as the initial motif. If TRUE, the following fields would be added to the return value:
"db_motif", "db_motif_pred", "db_motif_pssm" and "db_motif_score".</p></dd>


<dt id="arg-val-frac">val_frac<a class="anchor" aria-label="anchor" href="#arg-val-frac"></a></dt>
<dd><p>fraction of the dataset to use for the internal validation. when using multiple kmers. Default: 0.1.</p></dd>


<dt id="arg-xmin-xmax-npts">xmin, xmax, npts<a class="anchor" aria-label="anchor" href="#arg-xmin-xmax-npts"></a></dt>
<dd><p>range for the energy function and the number of points to use for its interpolation.</p></dd>


<dt id="arg-kmer-sequence-length">kmer_sequence_length<a class="anchor" aria-label="anchor" href="#arg-kmer-sequence-length"></a></dt>
<dd><p>the length of the sequence to use for the kmer screen. If NULL, the entire sequence would be used.</p></dd>


<dt id="arg-symmetrize-spat">symmetrize_spat<a class="anchor" aria-label="anchor" href="#arg-symmetrize-spat"></a></dt>
<dd><p>if TRUE, the spatial model would be symmetrized around the center bin. Default: TRUE.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>a list with the following elements:</p><dl><dt>pssm: </dt>
<dd><p>data frame with the pssm matrix with the inferred motif, where rows are positions and columns are nucleotides.</p></dd>

<dt>spat: </dt>
<dd><p>a data frame with the inferred spatial model, with the spatial factor for each bin.</p></dd>

<dt>pred: </dt>
<dd><p>a vector with the predicted pwm for each sequence.</p></dd>

<dt>consensus: </dt>
<dd><p>Consensus sequence based on the PSSM.</p></dd>

<dt>response: </dt>
<dd><p>The response matrix. If <code>include_response</code> is FALSE, the response matrix is not included in the list.</p></dd>

<dt>r2: </dt>
<dd><p>\(r^2\) of the prediction with respect to the each response variable.</p></dd>

<dt>ks: </dt>
<dd><p>If response is binary, Kolmogorov-Smirnov test results of the predictions where the response was 1 vs the predictions where the response was 0.</p></dd>

<dt>seed_motif: </dt>
<dd><p>The seed motif that started the regression.</p></dd>

<dt>kmers: </dt>
<dd><p>The k-mers that were screened in order to find the best seed motif (if motif was NULL).</p></dd>

<dt>sample_idxs: </dt>
<dd><p>The indices of the sequences that were used for the regression (only for <code>regress_pwm.sample</code>).</p></dd>

<dt>predict: </dt>
<dd><p>a function that can be used to predict the PWM for a new sequence.</p></dd>


</dl><p>When <code>match_with_db</code> is TRUE, the following additional elements are returned:</p><dl><dt>motif_db: </dt>
<dd><p>The motif database that the most similar to the resulting PSSM.</p></dd>

<dt>db_match_cor: </dt>
<dd><p>The correlation between the resulting PSSM and the closest match in the motif database.</p></dd>

<dt>db_match_pssm: </dt>
<dd><p>The PSSM of the closest match in the motif database.</p></dd>

<dt>db_match_pred: </dt>
<dd><p>The predicted PWM of the closest match in the motif database.</p></dd>

<dt>db_match_r2: </dt>
<dd><p>The \(r^2\) of the predicted PWM of the closest match in the motif database and the response</p></dd>

<dt>db_match_ks: </dt>
<dd><p>If response is binary, the Kolmogorov-Smirnov test results of the predicted PWM of the closest match in the motif database where the response was 1 vs the predictions where the response was 0.</p></dd>


</dl><p>When <code>screen_db</code> is TRUE, the following additional elements are returned:</p><dl><dt>db_motif: </dt>
<dd><p>The best motif from the motif database.</p></dd>

<dt>db_motif_pred: </dt>
<dd><p>The predicted PWM of the best motif from the motif database.</p></dd>

<dt>db_motif_pssm: </dt>
<dd><p>The PSSM of the best motif from the motif database.</p></dd>

<dt>db_motif_score: </dt>
<dd><p>The score of the best motif from the motif database.</p></dd>


</dl><p>When <code>n_motifs</code> is greater than 1, a list with the following elements is returned:</p><dl><dt>models: </dt>
<dd><p>A list (as above) of each inferred model</p></dd>

<dt>multi_stats: </dt>
<dd><p>A data frame with the following columns: <code>model</code>, <code>score</code> (KS for binary, r^2 otherwise), <code>comb_score</code> (score for the combined linear model for models 1:i) and additional statistics per model</p></dd>

<dt>pred: </dt>
<dd><p>a vector with the predicted pwm for using a linear model of the combined scores.</p></dd>

<dt>comb_modle: </dt>
<dd><p>a linear model of the combined scores.</p></dd>

<dt>predict: </dt>
<dd><p>a function that can be used to predict the PWM for a new sequence.</p></dd>

<dt>predict_multi: </dt>
<dd><p>a function that can be used to predict the PWM for the different models for a new sequence</p></dd>


</dl></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span><span class="va">sequences_example</span>, <span class="va">response_mat_example</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">pssm</span></span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">spat</span></span></span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_regression_qc.html">plot_regression_qc</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># intialize with a pre-computed PSSM</span></span></span>
<span class="r-in"><span><span class="va">res1</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span><span class="va">sequences_example</span>, <span class="va">response_mat_example</span>, motif <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">pssm</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># intialize with a pre-computed PSSM and spatial model</span></span></span>
<span class="r-in"><span><span class="va">res2</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">sequences_example</span>,</span></span>
<span class="r-in"><span>    <span class="va">response_mat_example</span>,</span></span>
<span class="r-in"><span>    motif <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">pssm</span>,</span></span>
<span class="r-in"><span>    spat_model <span class="op">=</span> <span class="va">res</span><span class="op">$</span><span class="va">spat</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># binary response</span></span></span>
<span class="r-in"><span><span class="va">res_binary</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span><span class="va">cluster_sequences_example</span>, <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_regression_qc.html">plot_regression_qc</a></span><span class="op">(</span><span class="va">res_binary</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># match with db</span></span></span>
<span class="r-in"><span><span class="va">res_binary</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span><span class="va">cluster_sequences_example</span>, <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, match_with_db <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_regression_qc.html">plot_regression_qc</a></span><span class="op">(</span><span class="va">res_binary</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Screen for best db motif</span></span></span>
<span class="r-in"><span><span class="va">res_binary</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span><span class="va">cluster_sequences_example</span>, <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, screen_db <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_regression_qc.html">plot_regression_qc</a></span><span class="op">(</span><span class="va">res_binary</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># initialize with a motif from the database</span></span></span>
<span class="r-in"><span><span class="va">res_binary</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cluster_sequences_example</span>,</span></span>
<span class="r-in"><span>    <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    init_from_dataset <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># use multiple kmer seeds</span></span></span>
<span class="r-in"><span><span class="va">res_multi</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cluster_sequences_example</span>,</span></span>
<span class="r-in"><span>    <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    multi_kmers <span class="op">=</span> <span class="cn">TRUE</span>,</span></span>
<span class="r-in"><span>    kmer_length <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span>,</span></span>
<span class="r-in"><span>    final_metric <span class="op">=</span> <span class="st">"ks"</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_regression_qc.html">plot_regression_qc</a></span><span class="op">(</span><span class="va">res_multi</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Screen for multiple motifs</span></span></span>
<span class="r-in"><span><span class="va">res_multi</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cluster_sequences_example</span>,</span></span>
<span class="r-in"><span>    <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    motif_num <span class="op">=</span> <span class="fl">3</span>,</span></span>
<span class="r-in"><span>    match_with_db <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="va">res_multi</span><span class="op">$</span><span class="va">multi_stats</span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_regression_qc_multi.html">plot_regression_qc_multi</a></span><span class="op">(</span><span class="va">res_multi</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># regress_multiple_motifs is an alias for regress_pwm with motif_num &gt; 1</span></span></span>
<span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="va">res_multi2</span> <span class="op">&lt;-</span> <span class="fu">regress_multiple_motifs</span><span class="op">(</span></span></span>
<span class="r-in"><span>    <span class="va">cluster_sequences_example</span>,</span></span>
<span class="r-in"><span>    <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>,</span></span>
<span class="r-in"><span>    motif_num <span class="op">=</span> <span class="fl">5</span>,</span></span>
<span class="r-in"><span>    match_with_db <span class="op">=</span> <span class="cn">TRUE</span></span></span>
<span class="r-in"><span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by Aviezer Lifshitz, Amos Tanay.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

