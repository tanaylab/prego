<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><meta name="description" content="The first phase of the optimization would be performed with a sampled dataset of size two_phase_sample_frac where different candidates of kmers would be regressed in order to find the best seed. Thenm the optimization would be performed on the full dataset while initializing the motif from the sampled dataset. You can also give explicit indices of the sequences to use in the first phase using first_phase_idxs."><title>Run a 2-phase PWM regression — regress_pwm.two_phase • prego</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.1.0/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.1.0/bootstrap.bundle.min.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous"><!-- bootstrap-toc --><script src="https://cdn.rawgit.com/afeld/bootstrap-toc/v1.0.1/dist/bootstrap-toc.min.js"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- search --><script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/6.4.6/fuse.js" integrity="sha512-zv6Ywkjyktsohkbp9bb45V6tEMoWhzFzXis+LrMehmJZZSys19Yxf1dopHx7WzIKxr5tK2dVcYmaCk2uqdjF4A==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/autocomplete.js/0.38.0/autocomplete.jquery.min.js" integrity="sha512-GU9ayf+66Xx2TmpxqJpliWbT5PiGYxpaG8rfnBEk1LL8l1KGkRShhngwdXK1UgqhAzWpZHSiYPc09/NwDQIGyg==" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/mark.min.js" integrity="sha512-5CYOlHXGh6QpOFA/TeTylKLWfB3ftPsde7AnmhuitiTX4K5SqCLBeKro6sPS8ilsz1Q4NRx3v8Ko2IBiszzdww==" crossorigin="anonymous"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Run a 2-phase PWM regression — regress_pwm.two_phase"><meta property="og:description" content="The first phase of the optimization would be performed with a sampled dataset of size two_phase_sample_frac where different candidates of kmers would be regressed in order to find the best seed. Thenm the optimization would be performed on the full dataset while initializing the motif from the sampled dataset. You can also give explicit indices of the sequences to use in the first phase using first_phase_idxs."><!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>
    

    <nav class="navbar fixed-top navbar-light navbar-expand-lg bg-light"><div class="container">
    
    <a class="navbar-brand me-2" href="../index.html">prego</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">0.0.0.9000</small>

    
    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item">
  <a class="nav-link" href="../reference/index.html">Reference</a>
</li>
      </ul><form class="form-inline my-2 my-lg-0" role="search">
        <input type="search" class="form-control me-sm-2" aria-label="Toggle navigation" name="search-input" data-search-index="../search.json" id="search-input" placeholder="Search for" autocomplete="off"></form>

      <ul class="navbar-nav"></ul></div>

    
  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">
      <img src="" class="logo" alt=""><h1>Run a 2-phase PWM regression</h1>
      
      <div class="d-none name"><code>regress_pwm.two_phase.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>The first phase of the optimization would be performed with a sampled dataset of size <code>two_phase_sample_frac</code> where different candidates of kmers would be regressed in order to find the best seed. Thenm the optimization would be performed on the full dataset while initializing the motif from the sampled dataset. You can also give explicit indices of the sequences to use in the first phase using <code>first_phase_idxs</code>.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">regress_pwm.two_phase</span><span class="op">(</span></span>
<span>  <span class="va">sequences</span>,</span>
<span>  <span class="va">response</span>,</span>
<span>  motif_length <span class="op">=</span> <span class="fl">15</span>,</span>
<span>  score_metric <span class="op">=</span> <span class="st">"r2"</span>,</span>
<span>  bidirect <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  spat_min <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  spat_max <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  spat_bin <span class="op">=</span> <span class="fl">50</span>,</span>
<span>  improve_epsilon <span class="op">=</span> <span class="fl">0.0001</span>,</span>
<span>  min_nuc_prob <span class="op">=</span> <span class="fl">0.001</span>,</span>
<span>  unif_prior <span class="op">=</span> <span class="fl">0.05</span>,</span>
<span>  is_train <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  include_response <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>  seed <span class="op">=</span> <span class="fl">60427</span>,</span>
<span>  verbose <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>  kmer_length <span class="op">=</span> <span class="fl">6</span><span class="op">:</span><span class="fl">8</span>,</span>
<span>  min_gap <span class="op">=</span> <span class="fl">0</span>,</span>
<span>  max_gap <span class="op">=</span> <span class="fl">1</span>,</span>
<span>  min_kmer_cor <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  consensus_single_thresh <span class="op">=</span> <span class="fl">0.6</span>,</span>
<span>  consensus_double_thresh <span class="op">=</span> <span class="fl">0.85</span>,</span>
<span>  two_phase_sample_frac <span class="op">=</span> <span class="fl">0.1</span>,</span>
<span>  first_phase_idxs <span class="op">=</span> <span class="cn">NULL</span>,</span>
<span>  first_phase_metric <span class="op">=</span> <span class="st">"r2"</span>,</span>
<span>  parallel <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/options.html" class="external-link">getOption</a></span><span class="op">(</span><span class="st">"prego.parallel"</span>, <span class="cn">FALSE</span><span class="op">)</span>,</span>
<span>  <span class="va">...</span></span>
<span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>
    <dl><dt>sequences</dt>
<dd><p>A vector of DNA sequences ('A', 'T', 'C' or 'G'. Will go through <code>toupper</code>)</p></dd>


<dt>response</dt>
<dd><p>A matrix of response variables - number of rows should equal the number of sequences</p></dd>


<dt>is_train</dt>
<dd><p>a boolean vector that determine which subset of sequences to use when screening</p></dd>


<dt>seed</dt>
<dd><p>random seed</p></dd>


<dt>verbose</dt>
<dd><p>verbosity of the second phase of the optimization.</p></dd>


<dt>kmer_length</dt>
<dd><p>a vector of kmer lengths to screen in order to find the best seed motif.</p></dd>


<dt>min_gap, max_gap</dt>
<dd><p>the length of a gap to be considered in the pattern. Only one gap, of length min_gap:max_gap, is being used, and is located anywhere in the motif. Note that this greatly expand the search space (and increase multiple tesing severly).</p></dd>


<dt>two_phase_sample_frac</dt>
<dd><p>fraction of the dataset to sample for the first phase of the optimization (default: 0.1). When <code>response</code> is categorical (0 and 1), the sampling would be stratified by the category,
i.e. <code>two_phase_sample_frac</code> can be a vector of length 2 with the fraction of 0 and 1 responses to sample
respectively.</p></dd>


<dt>first_phase_idxs</dt>
<dd><p>indices of the sequences to use in the first phase of the optimization. If NULL, the indices would be sampled using <code>two_phase_sample_frac</code>.</p></dd>


<dt>first_phase_metric</dt>
<dd><p>metric to use in order to choose the best motif in the first phase of the optimization. One of 'ks' or 'r2'. Note that unlike <code>score_metric</code> which is used in the regression itself, this metric is used only for choosing the best motif in the first phase of the optimization out of all the runs on the sampled dataset.</p></dd>


<dt>parallel</dt>
<dd><p>whether to run the first phase of the optimization in parallel. use <code>set_parallel</code>
to set the number of cores to use.</p></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    

<p>a list with the following elements:</p><ul><li><p>pssm: data frame with the pssm matrix with the inferred motif, where rows are positions and columns are nucleotides.</p></li>
<li><p>spat: a data frame with the inferred spatial model, with the spatial factor for each bin.</p></li>
<li><p>pred: a vector with the predicted pwm for each sequence.</p></li>
<li><p>consensus: Consensus sequence based on the PSSM.</p></li>
<li><p>response: The response matrix. If <code>include_response</code> is FALSE, the response matrix is not included in the list.</p></li>
<li><p>r2: \(r^2\) of the prediction with respect to the each response variable.</p></li>
<li><p>ks: If response is binary, Kolmogorov-Smirnov test results of the predictions where the response was 1 vs the predictions where the response was 0.</p></li>
<li><p>seed_motif: The seed motif that started the regression.</p></li>
<li><p>kmers: The k-mers that were screened in order to find the best seed motif (if motif was NULL).</p></li>
</ul></div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="va">res</span> <span class="op">&lt;-</span> <span class="fu">regress_pwm.two_phase</span><span class="op">(</span><span class="va">cluster_sequences_example</span>, <span class="va">cluster_mat_example</span><span class="op">[</span>, <span class="fl">1</span><span class="op">]</span>, two_phase_sample_frac <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="fl">0.1</span>, <span class="fl">1</span><span class="op">)</span>, first_phase_metric <span class="op">=</span> <span class="st">"ks"</span><span class="op">)</span></span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Performing two phase optimization</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">First phase</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Sampling <span style="color: #0000BB;">0.1</span> and <span style="color: #0000BB;">1</span> of the dataset for the first phase</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Stratified sampling</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> sampled <span style="color: #0000BB;">187</span> 0s and <span style="color: #0000BB;">492</span> 1s</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Generate candidate kmers </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── Regress each candidate kmer on sampled data </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Running regression on <span style="color: #0000BB;">12</span> candidate kmers</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Best motif in the first phase: <span style="color: #0000BB;">"***AAT*ATTAA***"</span>, score (ks): <span style="color: #0000BB;">0.838485283248554</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> ── <span style="font-weight: bold;">Phase 2: Running regression on the full dataset</span> ──</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> </span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Number of response variables: <span style="color: #0000BB;">1</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Initializing regression with pre-computed PSSM</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BBBB;">ℹ</span> Running regression</span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Motif length: <span style="color: #0000BB;">15</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Bidirectional: <span style="color: #0000BB;">TRUE</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Spat min: <span style="color: #0000BB;">0</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Spat max: <span style="color: #0000BB;">300</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Spat bin: <span style="color: #0000BB;">50</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Improve epsilon: <span style="color: #0000BB;">0.0001</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Min nuc prob: <span style="color: #0000BB;">0.001</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Uniform prior: <span style="color: #0000BB;">0.05</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Score metric: <span style="color: #0000BB;">"r2"</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> • Seed: <span style="color: #0000BB;">60427</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> Finished running regression. Consensus: <span style="color: #0000BB;">"R*W**KT*A"</span></span>
<span class="r-msg co"><span class="r-pr">#&gt;</span> <span style="color: #00BB00;">✔</span> KS test D: <span style="color: #0000BB;">0.8514</span>, p-value: <span style="color: #0000BB;">0</span></span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">pssm</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>    pos           A           C            G           T</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1    0 0.245213479 0.199648947 0.3544846475 0.200652897</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2    1 0.229571313 0.229029343 0.2665824592 0.274816871</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3    2 0.206375405 0.314317167 0.2063754052 0.272932082</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4    3 0.552452564 0.026117221 0.3165676296 0.104862511</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5    4 0.422739089 0.323862046 0.0008286987 0.252570212</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6    5 0.385407656 0.001017793 0.1289312989 0.484643310</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7    6 0.180220529 0.296123028 0.2765798867 0.247076511</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 8    7 0.529875934 0.001052755 0.2350929976 0.233978301</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 9    8 0.001042730 0.143259510 0.2843351960 0.571362615</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 10   9 0.001020463 0.217244446 0.0011460028 0.780589044</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 11  10 0.531432629 0.160017207 0.1187699735 0.189780191</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 12  11 0.713790655 0.060005266 0.2251836807 0.001020418</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 13  12 0.223730654 0.474828452 0.1484422535 0.152998671</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 14  13 0.242873088 0.316447675 0.1874947399 0.253184527</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 15  14 0.264937550 0.247455552 0.2487054169 0.238901496</span>
<span class="r-in"><span><span class="va">res</span><span class="op">$</span><span class="va">spat</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span>   bin spat_factor</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 1   0  0.05940168</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 2  50  0.17209892</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 3 100  0.19395736</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 4 150  0.18225275</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 5 200  0.15660921</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 6 250  0.06358673</span>
<span class="r-out co"><span class="r-pr">#&gt;</span> 7 300  0.17209892</span>
<span class="r-in"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">res</span><span class="op">$</span><span class="va">pred</span><span class="op">)</span></span></span>
<span class="r-out co"><span class="r-pr">#&gt;</span> [1] -16.38393 -16.55559 -17.03628 -15.35067 -15.33256 -14.61532</span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="fu"><a href="plot_regression_qc.html">plot_regression_qc</a></span><span class="op">(</span><span class="va">res</span><span class="op">)</span></span></span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; = "none")` instead.</span>
<span class="r-wrn co"><span class="r-pr">#&gt;</span> <span class="warning">Warning: </span>`guides(&lt;scale&gt; = FALSE)` is deprecated. Please use `guides(&lt;scale&gt; = "none")` instead.</span>
<span class="r-plt img"><img src="regress_pwm.two_phase-1.png" alt="" width="700" height="433"></span>
<span class="r-in"><span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p></p><p>Developed by Aviezer Lifshitz, Amos Tanay.</p>
</div>

<div class="pkgdown-footer-right">
  <p></p><p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.5.</p>
</div>

    </footer></div>

  

  

  </body></html>

