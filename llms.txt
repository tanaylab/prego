# prego

The `prego` package implements simple regression algorithms for finding
motifs in DNA. You can either use it to find motif which are
discriminating between two or more clusters of DNA sequences, or for
generating motifs from one or more continuous variables.

The PREGO algorithm is described
[here](https://doi.org/10.1101%2Fgr.5113606).

## Installation

You can install the development version of prego like so:

``` r
remotes::install_github("tanaylab/prego")
```

## Usage

``` r
library(prego)
#> ℹ Parallelization enabled. Using 77 threads. 
```

For a set of continuous variables:

``` r
res <- regress_pwm(sequences_example, response_mat_example)
#> ℹ Using "r2" as the final metric
#> ℹ Number of response variables: 5
#> 
#> ── Generate candidate kmers
#> 
#> ── Regress each candidate kmer
#> ℹ Running regression on 10 candidate kmers
#> • Bidirectional: TRUE
#> • Spat bin size: 40
#> • Number of spatial bins 7
#> • Length of sequence: 280
#> • Min gap: 0
#> • Max gap: 1
#> • Kmer length: 8
#> • Improve epsilon: 1e-04
#> • Min nuc prob: 0.001
#> • Uniform prior: 0.05
#> • Score metric: "r2"
#> • Seed: 60427
#> • kmer: "TTTACAAC", score (r2): 0.0126890005368537
#> • kmer: "TA*CTGCTG", score (r2): 0.00334159650449452
#> • kmer: "AACCATCT", score (r2): 0.0643097230120355
#> • kmer: "AGA*AAGAA", score (r2): 0.060384757659326
#> • kmer: "TTATC*TCT", score (r2): 0.0657310811484614
#> • kmer: "TCACCTTG", score (r2): 0.0623381197705449
#> • kmer: "CTCTGCAG", score (r2): 0.0677598761958694
#> • kmer: "TAGCTGTC", score (r2): 0.0640768115164421
#> • kmer: "GACAAT*CT", score (r2): 0.0607251519441225
#> • kmer: "TCTTATCT", score (r2): 0.0628163788281552
#> ℹ Best match in the database: "JASPAR.ct", cor: 0.667
#> ℹ Best motif: "***CTCTGCAG****", score (r2): 0.0677598761958694
plot_regression_qc(res)
#> Warning: The `<scale>` argument of `guides()` cannot be `FALSE`. Use "none" instead as
#> of ggplot2 3.3.4.
#> ℹ The deprecated feature was likely used in the ggseqlogo package.
#>   Please report the issue at <https://github.com/omarwagih/ggseqlogo/issues>.
#> This warning is displayed once every 8 hours.
#> Call `lifecycle::last_lifecycle_warnings()` to see where this warning was
#> generated.
```

![](reference/figures/README-unnamed-chunk-3-1.png)

For binary response:

``` r
res_binary <- regress_pwm(cluster_sequences_example, cluster_mat_example[, 1])
#> ℹ Using "ks" as the final metric
#> ℹ Number of response variables: 1
#> 
#> ── Generate candidate kmers
#> 
#> ── Regress each candidate kmer
#> ℹ Running regression on 10 candidate kmers
#> • Bidirectional: TRUE
#> • Spat bin size: 40
#> • Number of spatial bins 7
#> • Length of sequence: 280
#> • Min gap: 0
#> • Max gap: 1
#> • Kmer length: 8
#> • Improve epsilon: 1e-04
#> • Min nuc prob: 0.001
#> • Uniform prior: 0.05
#> • Score metric: "r2"
#> • Seed: 60427
#> • kmer: "TTAAT*ATT", score (ks): 0.854878919705105
#> • kmer: "AAT*ATTAA", score (ks): 0.854878919705105
#> • kmer: "TAAT*ATTA", score (ks): 0.843301065576269
#> • kmer: "GTTAAT*AT", score (ks): 0.844482257088238
#> • kmer: "AT*ATTAAC", score (ks): 0.844482257088238
#> • kmer: "AA*CATTAA", score (ks): 0.84950858078479
#> • kmer: "TTAA*CATT", score (ks): 0.849192870611084
#> • kmer: "TAATCATT", score (ks): 0.841995767306361
#> • kmer: "TTA*TCATT", score (ks): 0.845127829960678
#> • kmer: "TAA*CATTA", score (ks): 0.833248418183164
#> ℹ Best match in the database: "JOLMA.HNF1B_di_full_1", cor: 0.8
#> ✔ "JOLMA.HNF1B_di_full_1" KS test D: 0.8512, p-value: 0
#> ℹ Best motif: "***TTAAT*ATT***", score (ks): 0.854878919705105
plot_regression_qc(res_binary)
```

![](reference/figures/README-unnamed-chunk-4-1.png)

For clusters of sequences:

``` r
res <- regress_pwm.clusters(cluster_sequences_example, clusters_example)
#> ℹ Using sampled optimization
#> ℹ Running regression for 5 clusters
#> ℹ Matching with motif databases
res$stats
#> # A tibble: 5 × 7
#>   cluster consensus  ks_D    r2 seed_motif      db_match                 db_ma…¹
#>   <chr>   <chr>     <dbl> <dbl> <chr>           <chr>                      <dbl>
#> 1 c100    GA***AT   0.668 0.326 ***TGATGG*TG*** HOCOMOCO.PDX1_HUMAN.H11…   0.786
#> 2 c111    Y**TAAA   0.836 0.514 ***GC*ATAAAA*** JOLMA.CDX2_mono_DBD        0.889
#> 3 c29     T*A***W*Y 0.830 0.552 ***TTAA*CATT*** JOLMA.HNF1B_di_full_1      0.745
#> 4 c5      <NA>      0.569 0.194 ***TGAT*GATG*** JASPAR.CG15696-RA          0.725
#> 5 c6      ATC       0.606 0.262 ***TCTTATCT**** HOMER.Gata2                0.864
#> # … with abbreviated variable name ¹​db_match_cor
```

# Package index

## Motif Regression

- [`regress_multiple_motifs()`](https://tanaylab.github.io/prego/reference/regress_pwm.md)
  [`regress_pwm()`](https://tanaylab.github.io/prego/reference/regress_pwm.md)
  : Perform a PWM regression
- [`regress_pwm.clusters()`](https://tanaylab.github.io/prego/reference/regress_pwm.clusters.md)
  : Run PWM regression on clusters
- [`regress_pwm.cv()`](https://tanaylab.github.io/prego/reference/regress_pwm.cv.md)
  : Cross-validate a PWM regression model
- [`regress_pwm.sample()`](https://tanaylab.github.io/prego/reference/regress_pwm.sample.md)
  : Run PWM regression on a sample of the data
- [`plot_regression_prediction()`](https://tanaylab.github.io/prego/reference/plot_regression_prediction.md)
  : Plot response variable averages vs the regression model's prediction
- [`plot_regression_prediction_binary()`](https://tanaylab.github.io/prego/reference/plot_regression_prediction_binary.md)
  : Plot the cumulative of the regression model's prediction stratified
  by the response variable
- [`plot_regression_qc()`](https://tanaylab.github.io/prego/reference/plot_regression_qc.md)
  : Plot the regression results
- [`plot_regression_qc_multi()`](https://tanaylab.github.io/prego/reference/plot_regression_qc_multi.md)
  : Plot the regression results for multiple motifs
- [`plot_spat_model()`](https://tanaylab.github.io/prego/reference/plot_spat_model.md)
  : Plot spatial model of the regression result
- [`export_multi_regression()`](https://tanaylab.github.io/prego/reference/export_multi_regression.md)
  : Export a multiple motif regression model
- [`export_regression_model()`](https://tanaylab.github.io/prego/reference/export_regression_model.md)
  : Export a motif regression model
- [`load_multi_regression()`](https://tanaylab.github.io/prego/reference/load_multi_regression.md)
  : Load a multiple motif regression model from a file
- [`load_regression_model()`](https://tanaylab.github.io/prego/reference/load_regression_model.md)
  : Load a motif regression model from a file

## kmers

- [`screen_kmers()`](https://tanaylab.github.io/prego/reference/screen_kmers.md)
  : Screen for kmers
- [`generate_kmers()`](https://tanaylab.github.io/prego/reference/generate_kmers.md)
  : Generate kmers
- [`kmer_matrix()`](https://tanaylab.github.io/prego/reference/kmer_matrix.md)
  : Generate a kmer Matrix
- [`kmers_to_pssm()`](https://tanaylab.github.io/prego/reference/kmers_to_pssm.md)
  : Transform k-mers to PSSM (Position-Specific Scoring Matrix)

## MotifDB

- [`MotifDB-class`](https://tanaylab.github.io/prego/reference/MotifDB-class.md)
  : MotifDB Class
- [`as.data.frame(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/as.data.frame-MotifDB-method.md)
  : Convert a MotifDB object to a data frame
- [`as.matrix(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/as.matrix-MotifDB-method.md)
  : Convert a MotifDB object to a matrix
- [`initialize(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/initialize-MotifDB-method.md)
  : Initialize method for MotifDB objects
- [`length(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/length-MotifDB-method.md)
  : Get the length of a MotifDB object
- [`names(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/names-MotifDB-method.md)
  : Get the names of motifs in a MotifDB object
- [`plot(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/plot-MotifDB-method.md)
  : Plot a motif from a MotifDB object
- [`prior(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/prior-MotifDB-method.md)
  : Get the prior value from a MotifDB object
- [`` `prior<-`( ``*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/prior-set-MotifDB-method.md)
  : Set a new prior for a MotifDB object
- [`show(`*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/show-MotifDB-method.md)
  : Show method for MotifDB objects
- [`` `[`( ``*`<MotifDB>`*`)`](https://tanaylab.github.io/prego/reference/sub-MotifDB-method.md)
  : Get specific motifs from the MotifDB
- [`MOTIF_DB`](https://tanaylab.github.io/prego/reference/MOTIF_DB.md) :
  A MotifDB object with motifs from all bundled databases
- [`motif_db_to_dataframe()`](https://tanaylab.github.io/prego/reference/motif_db_to_dataframe.md)
  : Convert a MotifDB object back to a tidy data frame
- [`` `prior<-`() ``](https://tanaylab.github.io/prego/reference/prior-set.md)
  : Set the prior for a MotifDB object
- [`prior()`](https://tanaylab.github.io/prego/reference/prior.md) : Get
  or set the prior for a MotifDB object
- [`create_motif_db()`](https://tanaylab.github.io/prego/reference/create_motif_db.md)
  : Create a MotifDB object from a tidy data frame

## PSSM/PWM utils

- [`compute_pwm()`](https://tanaylab.github.io/prego/reference/compute_pwm.md)
  : Compute PWMs for a set of sequences given a PSSM matrix
- [`extract_pwm_old()`](https://tanaylab.github.io/prego/reference/extract_pwm.md)
  [`extract_pwm()`](https://tanaylab.github.io/prego/reference/extract_pwm.md)
  : Extract pwm of sequences from a motif database
- [`gextract_pwm_old()`](https://tanaylab.github.io/prego/reference/gextract_pwm.md)
  [`gextract_pwm()`](https://tanaylab.github.io/prego/reference/gextract_pwm.md)
  : Extract pwm of intervals from a motif database
- [`consensus_from_pssm()`](https://tanaylab.github.io/prego/reference/consensus_from_pssm.md)
  : Convert PSSM to consensus sequence
- [`pssm_diff()`](https://tanaylab.github.io/prego/reference/pssm_diff.md)
  : Compute the KL divergence between two given PSSMs
- [`pssm_match()`](https://tanaylab.github.io/prego/reference/pssm_match.md)
  : Match PSSM to a directory of motifs
- [`pssm_cor()`](https://tanaylab.github.io/prego/reference/pssm_cor.md)
  : Compute the correlation between two given PSSMs
- [`plot_pssm_logo()`](https://tanaylab.github.io/prego/reference/plot_pssm_logo.md)
  : Plot LOGO of the pssm result from the regression
- [`plot_pssm_logo_dataset()`](https://tanaylab.github.io/prego/reference/plot_pssm_logo_dataset.md)
  : Plot LOGO of pssm from dataset (e.g. "HOMER" or "JASPAR")
- [`all_motif_datasets()`](https://tanaylab.github.io/prego/reference/all_motif_datasets.md)
  : Get a data frame of all the motif datasets bundled with prego
- [`screen_pwm()`](https://tanaylab.github.io/prego/reference/screen_pwm.md)
  : Screen for motifs in a database given a response variable
- [`screen_pwm.clusters()`](https://tanaylab.github.io/prego/reference/screen_pwm.clusters.md)
  : Screen for motifs in a database for every cluster
- [`get_motif_pssm()`](https://tanaylab.github.io/prego/reference/get_motif_pssm.md)
  : Extract pssm of sequences from a motif database
- [`HOCOMOCO_motifs`](https://tanaylab.github.io/prego/reference/HOCOMOCO_motifs.md)
  : PSSMs from the HOCOMOCO motif database
- [`HOMER_motifs`](https://tanaylab.github.io/prego/reference/HOMER_motifs.md)
  : PSSMs from the HOMER motif database
- [`JASPAR_motifs`](https://tanaylab.github.io/prego/reference/JASPAR_motifs.md)
  : PSSMs from the JASPAR motif database
- [`JOLMA_motifs`](https://tanaylab.github.io/prego/reference/JOLMA_motifs.md)
  : PSSMs from the Jolma et al. motif database
- [`regress_multiple_motifs()`](https://tanaylab.github.io/prego/reference/regress_pwm.md)
  [`regress_pwm()`](https://tanaylab.github.io/prego/reference/regress_pwm.md)
  : Perform a PWM regression
- [`compute_local_pwm()`](https://tanaylab.github.io/prego/reference/compute_local_pwm.md)
  : Compute local PWMs for a set of sequences given a PSSM matrix
- [`gextract_pwm.quantile()`](https://tanaylab.github.io/prego/reference/gextract_pwm.quantile.md)
  : Extract quantiles of pwm of intervals from a motif database
- [`gpwm_quantiles()`](https://tanaylab.github.io/prego/reference/gpwm_quantiles.md)
  : Compute quantile of pwm for a given interval size
- [`mask_sequences_by_pwm()`](https://tanaylab.github.io/prego/reference/mask_sequences_by_pwm.md)
  : Mask sequences by thresholding the PWM
- [`trim_pssm()`](https://tanaylab.github.io/prego/reference/trim_pssm.md)
  [`pssm_trim()`](https://tanaylab.github.io/prego/reference/trim_pssm.md)
  : Trim PSSM
- [`bits_per_pos()`](https://tanaylab.github.io/prego/reference/bits_per_pos.md)
  : Calculate the number of bits per position in a Position-Specific
  Scoring Matrix (PSSM).
- [`calc_seq_pwm()`](https://tanaylab.github.io/prego/reference/calc_seq_pwm.md)
  : Calculate Position Weight Matrix (PWM) Scores for DNA Sequences
- [`pssm_concat()`](https://tanaylab.github.io/prego/reference/pssm_concat.md)
  [`concat_pssm()`](https://tanaylab.github.io/prego/reference/pssm_concat.md)
  : Concatenate two PSSM matrices
- [`pssm_dataset_cor()`](https://tanaylab.github.io/prego/reference/pssm_dataset_cor.md)
  : Compute correlation matrix for PSSM datasets
- [`pssm_dataset_diff()`](https://tanaylab.github.io/prego/reference/pssm_dataset_diff.md)
  : Compute KL divergence matrix for PSSM datasets
- [`pssm_rc()`](https://tanaylab.github.io/prego/reference/pssm_rc.md) :
  Reverse complement a PSSM
- [`pssm_theoretical_max()`](https://tanaylab.github.io/prego/reference/pssm_theoretical_max.md)
  [`pssm_theoretical_min()`](https://tanaylab.github.io/prego/reference/pssm_theoretical_max.md)
  [`pssm_quantile()`](https://tanaylab.github.io/prego/reference/pssm_theoretical_max.md)
  : Calculate Theoretical Scores for a Position-Specific Scoring Matrix
  (PSSM)
- [`pssm_to_kmer()`](https://tanaylab.github.io/prego/reference/pssm_to_kmer.md)
  : Transform PSSM (Position-Specific Scoring Matrix) to a KMER
- [`rc()`](https://tanaylab.github.io/prego/reference/rc.md) : Reverse
  Complement DNA Sequences

## Sequence utils

- [`intervals_to_seq()`](https://tanaylab.github.io/prego/reference/intervals_to_seq.md)
  : Convert intervals to sequences
- [`calc_sequences_dinuc_dist()`](https://tanaylab.github.io/prego/reference/calc_sequences_dinuc_dist.md)
  : Calculate Dinucleotide Distribution in Sequences
- [`calc_sequences_dinucs()`](https://tanaylab.github.io/prego/reference/calc_sequences_dinucs.md)
  : Calculate Dinucleotide Counts for Sequences
- [`calc_sequences_trinuc_dist()`](https://tanaylab.github.io/prego/reference/calc_sequences_trinuc_dist.md)
  : Calculate Trinucleotide Distribution in Sequences

## Local PWM

- [`gintervals.center_by_pssm()`](https://tanaylab.github.io/prego/reference/gintervals.center_by_pssm.md)
  : Center intervals by PSSM
- [`gextract.local_pwm()`](https://tanaylab.github.io/prego/reference/gextract.local_pwm.md)
  : Extracts local position weight matrix (PWM) scores for given
  intervals and a PWM.
- [`gextract.local_pwm_freq()`](https://tanaylab.github.io/prego/reference/gextract.local_pwm_freq.md)
  : Calculate the frequency of a position weight matrix (PWM) in a given
  set of intervals
- [`screen_local_pwm()`](https://tanaylab.github.io/prego/reference/screen_local_pwm.md)
  : Screen sequences for positions with PWM scores meeting a threshold
  condition

## other

- [`motif_enrichment()`](https://tanaylab.github.io/prego/reference/motif_enrichment.md)
  : Calculate motif enrichment
- [`sample_quantile_matched_rows()`](https://tanaylab.github.io/prego/reference/sample_quantile_matched_rows.md)
  : Sample rows respecting quantiles of a reference distribution
- [`set_parallel()`](https://tanaylab.github.io/prego/reference/set_parallel.md)
  : Set parallel threads
- [`cluster_mat_example`](https://tanaylab.github.io/prego/reference/cluster_mat_example.md)
  [`cluster_sequences_example`](https://tanaylab.github.io/prego/reference/cluster_mat_example.md)
  [`clusters_example`](https://tanaylab.github.io/prego/reference/cluster_mat_example.md)
  [`response_mat_example`](https://tanaylab.github.io/prego/reference/cluster_mat_example.md)
  [`sequences_example`](https://tanaylab.github.io/prego/reference/cluster_mat_example.md)
  : Dataset examples

